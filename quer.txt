SELECT T2.rcno,T2.operation,IF(T2.rcno LIKE 'A20%',T5.arcf,IF(T2.operation LIKE 'A%',T9.scn,IF(T2.operation LIKE 'SUB%','GURUMOOTHY',IF(T5.foreman IS NULL,T6.foreman,T5.foreman)))) as foreman,T6.foreman AS foreman1,T2.date,T2.issqty,T2.pnum,IF(T1.received IS NULL,'0',T1.received) as received,IF(T1.rejected IS NULL,'0',T1.rejected) as rejected,T2.rm as rm,IF(T2.rcno LIKE 'A20%','Kgs','Nos') as unit,IF(((T1.received+T1.rejected)*IF(T2.rcno LIKE 'A20%',IF(T3.useage IS NULL,T7.bom,T3.useage),1)) IS NULL,'0',(T1.received+T1.rejected)*IF(T2.rcno LIKE 'A20%',IF(T3.useage IS NULL,T7.bom,T3.useage),1)) as used,IF(T3.useage IS NULL,T7.bom,T3.useage),T2.issqty-IF(((T1.received+T1.rejected)*IF(T2.rcno LIKE 'A20%',IF(T3.useage IS NULL,T7.bom,T3.useage),1)) IS NULL,'0',(T1.received+T1.rejected)*IF(T2.rcno LIKE 'A20%',IF(T3.useage IS NULL,T7.bom,T3.useage),1)) as notused,datediff(NOW(),T2.date) as days,IF(T3.useage IS NULL,'1',IF(T3.useage IS NULL,T7.bom,T3.useage)) as bom,rate,per,(((T2.issqty-IF(((T1.received+T1.rejected)*IF(T2.rcno LIKE 'A20%',IF(T3.useage IS NULL,T7.bom,T3.useage),1)) IS NULL,'0',(T1.received+T1.rejected)*IF(T2.rcno LIKE 'A20%',IF(T3.useage IS NULL,T7.bom,T3.useage),1)))/IF(T3.useage IS NULL,'1',T3.useage))*rate)/per as value FROM (SELECT prcno,d12.pnum,SUM(partreceived) as received,SUM(qtyrejected) as rejected FROM `d12` WHERE d12.date>='2020-02-22' AND d12.date<='2020-02-22' AND prcno!='' GROUP BY d12.prcno) AS T1 RIGHT JOIN (SELECT DISTINCT d11.rcno,m14.oper as operation,d11.date,IF(d11.rcno LIKE 'A20%', d12.rm, '') as rm,d11.pnum,IF(d11.rcno LIKE 'A20%',d12.rmissqty,sum(d12.partissued)) as issqty FROM d12 JOIN d11 ON d12.rcno=d11.rcno LEFT JOIN m14 on d11.operation=m14.stkpt WHERE d11.rcno!='' AND d11.closedate='0000-00-00' AND d11.operation!='FG For Invoicing'  GROUP BY rcno ORDER BY date) AS T2 ON T1.prcno=T2.rcno LEFT JOIN (SELECT pnum,m13.rmdesc,uom,useage,foreman FROM m13) AS T3 ON (T2.pnum=T3.pnum AND T2.rm=T3.rmdesc) LEFT JOIN (SELECT DISTINCT(m13.pnum),foreman,rate,per,m12.operation as arcf FROM m13 LEFT JOIN m12 ON m13.pnum=m12.pnum LEFT JOIN pn_st ON pn_st.pnum=m13.pnum left JOIN invmaster ON pn_st.invpnum=invmaster.pn WHERE  pn_st.stkpt LIKE 'FG%' AND (m12.operation='Straitening/Shearing' OR m12.operation='CNC Machine') GROUP BY pnum) AS T5 ON (T2.pnum=T5.pnum) LEFT JOIN (SELECT invpnum,pn_st.pnum,foreman FROM `pn_st` LEFT JOIN m13 ON pn_st.pnum=m13.pnum WHERE pn_st.stkpt LIKE 'FG%') AS T6 ON T2.pnum=T6.invpnum LEFT JOIN (SELECT invpnum,SUM(useage) AS bom FROM pn_st LEFT JOIN m13 ON m13.pnum=pn_st.pnum AND m13.pnum!=pn_st.invpnum WHERE pn_st.stkpt LIKE 'FG%' GROUP BY invpnum) AS T7 ON T7.invpnum=T2.pnum LEFT JOIN (SELECT rcno,dcnum,scn FROM `d11` LEFT JOIN (SELECT dcnum,scn FROM `dc_det`) AS T8 ON d11.rcno=CONCAT('DC-',T8.dcnum) WHERE operation='FG For S/C' AND closedate='0000-00-00') AS T9 ON T2.rcno=T9.rcno GROUP BY T2.rcno order by t2.date,t2.rcno



//final dmr query
SELECT urcno,operation,category,oqty,issued,received,used,scrap,nqty,bom,obom,tot,tot1,yreceived,yrejected,IF(urcno LIKE '%A20%',yreceived*tot,yreceived) AS yyreceived,IF(urcno LIKE '%A20%',yrejected*tot,yrejected) AS yyrejected FROM(SELECT urcno,pnum,operation,category,IF(oqty IS NULL,0,oqty) AS oqty,IF(issued IS NULL,0,issued) AS issued,IF(received IS NULL,0,received) AS received,IF(used IS NULL,0,used) AS used,iF(scrap IS NULL,0,scrap) AS scrap,IF(nqty IS NULL,0,nqty) AS nqty,bom,obom,IF(tot IS NULL,bom,tot) AS tot,IF(tot1 IS NULL,obom,tot1) AS tot1 FROM(SELECT rcno AS urcno,pnum,operation,category FROM `openingstock` WHERE edate='2020-02-24' UNION SELECT rcno AS urcno,pnum,operation,category FROM opiss WHERE edate='2020-02-25') AS uniquerc LEFT JOIN(SELECT DISTINCT rcno,qty AS oqty FROM openingstock WHERE edate='2020-02-24') AS openstk ON uniquerc.urcno=openstk.rcno LEFT JOIN(SELECT DISTINCT rcno,issued,received,used,scrap FROM `opiss` WHERE edate='2020-02-25') AS opissued ON uniquerc.urcno=opissued.rcno LEFT JOIN(SELECT DISTINCT rcno,qty AS nqty FROM `nextdayopening` WHERE edate='2020-02-25') AS nxopenstk ON uniquerc.urcno=nxopenstk.rcno LEFT JOIN(SELECT DISTINCT pnum AS rmpnum,bom,obom FROM `rmcategory`) AS bom ON pnum=bom.rmpnum LEFT JOIN(SELECT invpnum,SUM(useage) AS tot FROM (SELECT DISTINCT pn_st.pnum,invpnum,useage FROM pn_st LEFT JOIN m13 ON m13.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS ipbompnst ON pnum=ipbompnst.invpnum LEFT JOIN(SELECT invpnum,SUM(obom) AS tot1 FROM (SELECT DISTINCT pn_st.pnum,invpnum,obom FROM pn_st LEFT JOIN rmcategory ON rmcategory.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS opbompnst ON pnum=opbompnst.invpnum) AS DMR
LEFT JOIN(SELECT prcno,d12.pnum,SUM(partreceived) as yreceived,SUM(qtyrejected) as yrejected FROM `d12` WHERE d12.date>='2020-02-24' AND d12.date<='2020-02-24' AND prcno!='' GROUP BY d12.prcno) AS yrec ON DMR.urcno=yrec.prcno



//DMRFI query
SELECT urcno,operation,category,oqty,issued,received,fused,fscrap,nqty,bom,obom,tot,tot1 FROM (SELECT urcno,operation,category,oqty,issued,received,used,scrap,nqty,bom,obom,tot,tot1,yreceived,yrejected,yyreceived,yyrejected,IF(yyreceived IS NULL,used,yyreceived) AS fused,IF(yyrejected IS NULL,scrap,yyrejected) AS fscrap FROM(SELECT  urcno,operation,category,oqty,issued,received,used,scrap,nqty,bom,obom,tot,tot1,yreceived,yrejected,IF(urcno LIKE '%A20%',yreceived*tot,yreceived) AS yyreceived,IF(urcno LIKE '%A20%',yrejected*tot,yrejected) AS yyrejected FROM(SELECT urcno,pnum,operation,category,IF(oqty IS NULL,0,oqty) AS oqty,IF(issued IS NULL,0,issued) AS issued,IF(received IS NULL,0,received) AS received,IF(used IS NULL,0,used) AS used,iF(scrap IS NULL,0,scrap) AS scrap,IF(nqty IS NULL,0,nqty) AS nqty,bom,obom,IF(tot IS NULL,bom,tot) AS tot,IF(tot1 IS NULL,obom,tot1) AS tot1 FROM(SELECT rcno AS urcno,pnum,operation,category FROM `openingstock` WHERE edate='2020-02-24' UNION SELECT rcno AS urcno,pnum,operation,category FROM opiss WHERE edate='2020-02-25') AS uniquerc LEFT JOIN(SELECT DISTINCT rcno,qty AS oqty FROM openingstock WHERE edate='2020-02-24') AS openstk ON uniquerc.urcno=openstk.rcno LEFT JOIN(SELECT DISTINCT rcno,issued,received,used,scrap FROM `opiss` WHERE edate='2020-02-25') AS opissued ON uniquerc.urcno=opissued.rcno LEFT JOIN(SELECT DISTINCT rcno,qty AS nqty FROM `nextdayopening` WHERE edate='2020-02-25') AS nxopenstk ON uniquerc.urcno=nxopenstk.rcno LEFT JOIN(SELECT DISTINCT pnum AS rmpnum,bom,obom FROM `rmcategory`) AS bom ON pnum=bom.rmpnum LEFT JOIN(SELECT invpnum,SUM(useage) AS tot FROM (SELECT DISTINCT pn_st.pnum,invpnum,useage FROM pn_st LEFT JOIN m13 ON m13.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS ipbompnst ON pnum=ipbompnst.invpnum LEFT JOIN(SELECT invpnum,SUM(obom) AS tot1 FROM (SELECT DISTINCT pn_st.pnum,invpnum,obom FROM pn_st LEFT JOIN rmcategory ON rmcategory.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS opbompnst ON pnum=opbompnst.invpnum) AS DMR
LEFT JOIN(SELECT prcno,d12.pnum,SUM(partreceived) as yreceived,SUM(qtyrejected) as yrejected FROM `d12` WHERE d12.date>='2020-02-24' AND d12.date<='2020-02-24' AND prcno!='' GROUP BY d12.prcno) AS yrec ON DMR.urcno=yrec.prcno) AS DMRF ) AS DMRFI


//mostfinal 
SELECT urcno,operation,pnum,category,oqty,issued,received,fused,fscrap,nqty,bom,obom,tot,tot1 FROM (SELECT urcno,operation,pnum,category,oqty,issued,received,used,scrap,nqty,bom,obom,tot,tot1,yreceived,yrejected,yyreceived,yyrejected,IF(yyreceived IS NULL,used,yyreceived) AS fused,IF(yyrejected IS NULL,scrap,yyrejected) AS fscrap FROM(SELECT  urcno,operation,pnum,category,oqty,issued,received,used,scrap,nqty,bom,obom,tot,tot1,yreceived,yrejected,IF(urcno LIKE '%A20%',yreceived*IF(bom IS NULL,tot,bom),yreceived) AS yyreceived,IF(urcno LIKE '%A20%',yrejected*IF(bom IS NULL,tot,bom),yrejected) AS yyrejected FROM(SELECT urcno,pnum,operation,category,IF(oqty IS NULL,0,oqty) AS oqty,IF(issued IS NULL,0,issued) AS issued,IF(received IS NULL,0,received) AS received,IF(used IS NULL,0,used) AS used,iF(scrap IS NULL,0,scrap) AS scrap,IF(nqty IS NULL,0,nqty) AS nqty,bom,obom,IF(tot IS NULL,bom,tot) AS tot,IF(tot1 IS NULL,obom,tot1) AS tot1 FROM(SELECT rcno AS urcno,pnum,operation,category FROM `openingstock` WHERE edate='2020-02-24' UNION SELECT rcno AS urcno,pnum,operation,category FROM opiss WHERE edate='2020-02-25') AS uniquerc LEFT JOIN(SELECT DISTINCT rcno,qty AS oqty FROM openingstock WHERE edate='2020-02-24') AS openstk ON uniquerc.urcno=openstk.rcno LEFT JOIN(SELECT DISTINCT rcno,issued,received,used,scrap FROM `opiss` WHERE edate='2020-02-25') AS opissued ON uniquerc.urcno=opissued.rcno LEFT JOIN(SELECT DISTINCT rcno,qty AS nqty FROM `nextdayopening` WHERE edate='2020-02-25') AS nxopenstk ON uniquerc.urcno=nxopenstk.rcno LEFT JOIN(SELECT DISTINCT pnum AS rmpnum,bom,obom FROM `rmcategory`) AS bom ON pnum=bom.rmpnum LEFT JOIN(SELECT invpnum,SUM(useage) AS tot FROM (SELECT DISTINCT pn_st.pnum,invpnum,useage FROM pn_st LEFT JOIN m13 ON m13.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS ipbompnst ON pnum=ipbompnst.invpnum LEFT JOIN(SELECT invpnum,SUM(obom) AS tot1 FROM (SELECT DISTINCT pn_st.pnum,invpnum,obom FROM pn_st LEFT JOIN rmcategory ON rmcategory.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS opbompnst ON pnum=opbompnst.invpnum) AS DMR
LEFT JOIN(SELECT prcno,d12.pnum AS yrecpnum,SUM(partreceived) as yreceived,SUM(qtyrejected) as yrejected FROM `d12` WHERE d12.date>='2020-02-24' AND d12.date<='2020-02-24' AND prcno!='' GROUP BY d12.prcno) AS yrec ON DMR.urcno=yrec.prcno) AS DMRF ) AS DMRFI


//anotherupdation
SELECT urcno,operation,pnum,category,oqty,issued,received,fused,fscrap,nqty,bom,ibom,obom,tot,tot1 FROM (SELECT urcno,operation,pnum,category,oqty,issued,received,used,scrap,nqty,bom,ibom,obom,tot,tot1,yreceived,yrejected,yyreceived,yyrejected,IF(yyreceived IS NULL,used,yyreceived) AS fused,IF(yyrejected IS NULL,scrap,yyrejected) AS fscrap FROM(SELECT  urcno,operation,pnum,category,oqty,issued,received,used,scrap,nqty,ibom,bom,obom,tot,tot1,yreceived,yrejected,IF(urcno LIKE '%A20%',yreceived*IF(ibom IS NULL,tot,ibom),yreceived) AS yyreceived,IF(urcno LIKE '%A20%',yrejected*IF(ibom IS NULL,tot,ibom),yrejected) AS yyrejected FROM(SELECT urcno,pnum,operation,category,IF(oqty IS NULL,0,oqty) AS oqty,IF(issued IS NULL,0,issued) AS issued,IF(received IS NULL,0,received) AS received,IF(used IS NULL,0,used) AS used,iF(scrap IS NULL,0,scrap) AS scrap,IF(nqty IS NULL,0,nqty) AS nqty,bom,ibom,obom,IF(tot IS NULL,ibom,tot) AS tot,IF(tot1 IS NULL,obom,tot1) AS tot1 FROM(SELECT rcno AS urcno,pnum,operation,category FROM `openingstock` WHERE edate='2020-02-24' UNION SELECT rcno AS urcno,pnum,operation,category FROM opiss WHERE edate='2020-02-25') AS uniquerc LEFT JOIN(SELECT DISTINCT rcno,qty AS oqty FROM openingstock WHERE edate='2020-02-24') AS openstk ON uniquerc.urcno=openstk.rcno LEFT JOIN(SELECT DISTINCT rcno,issued,received,used,scrap FROM `opiss` WHERE edate='2020-02-25') AS opissued ON uniquerc.urcno=opissued.rcno LEFT JOIN(SELECT DISTINCT rcno,qty AS nqty FROM `nextdayopening` WHERE edate='2020-02-25') AS nxopenstk ON uniquerc.urcno=nxopenstk.rcno LEFT JOIN(SELECT DISTINCT pnum AS m13pnum,useage AS ibom FROM `m13`) AS m13bom ON pnum=m13bom.m13pnum LEFT JOIN(SELECT DISTINCT pnum AS rmpnum,bom,obom FROM `rmcategory`) AS bom ON pnum=bom.rmpnum LEFT JOIN(SELECT invpnum,SUM(useage) AS tot FROM (SELECT DISTINCT pn_st.pnum,invpnum,useage FROM pn_st LEFT JOIN m13 ON m13.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS ipbompnst ON pnum=ipbompnst.invpnum LEFT JOIN(SELECT invpnum,SUM(obom) AS tot1 FROM (SELECT DISTINCT pn_st.pnum,invpnum,obom FROM pn_st LEFT JOIN rmcategory ON rmcategory.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS opbompnst ON pnum=opbompnst.invpnum) AS DMR
LEFT JOIN(SELECT prcno,d12.pnum AS yrecpnum,SUM(partreceived) as yreceived,SUM(qtyrejected) as yrejected FROM `d12` WHERE d12.date>='2020-02-24' AND d12.date<='2020-02-24' AND prcno!='' GROUP BY d12.prcno) AS yrec ON DMR.urcno=yrec.prcno) AS DMRF ) AS DMRFI

//query with updation return
SELECT DISTINCT urcno,operation,pnum,category,oqty,issued,received,fused,fscrap,ret,nqty,bom,ibom,obom,tot,tot1 FROM (SELECT DISTINCT urcno,operation,pnum,category,oqty,issued,received,used,scrap,IF(ret IS NULL,0,ret) AS ret,nqty,bom,ibom,obom,tot,tot1,yreceived,yrejected,yyreceived,yyrejected,IF(yyreceived IS NULL,used,yyreceived) AS fused,IF(yyrejected IS NULL,scrap,yyrejected) AS fscrap FROM(SELECT DISTINCT urcno,operation,pnum,category,oqty,issued,received,used,scrap,nqty,ibom,bom,obom,tot,tot1,yreceived,yrejected,IF(urcno LIKE '%A20%',yreceived*IF(ibom IS NULL,tot,ibom),yreceived) AS yyreceived,IF(urcno LIKE '%A20%',yrejected*IF(ibom IS NULL,tot,ibom),yrejected) AS yyrejected FROM(SELECT urcno,pnum,operation,category,IF(oqty IS NULL,0,oqty) AS oqty,IF(issued IS NULL,0,issued) AS issued,IF(received IS NULL,0,received) AS received,IF(used IS NULL,0,used) AS used,iF(scrap IS NULL,0,scrap) AS scrap,IF(nqty IS NULL,0,nqty) AS nqty,bom,ibom,obom,IF(tot IS NULL,ibom,tot) AS tot,IF(tot1 IS NULL,obom,tot1) AS tot1 FROM(SELECT rcno AS urcno,pnum,operation,category FROM `openingstock` WHERE edate='2020-02-24' UNION SELECT rcno AS urcno,pnum,operation,category FROM opiss WHERE edate='2020-02-25') AS uniquerc LEFT JOIN(SELECT DISTINCT rcno,qty AS oqty FROM openingstock WHERE edate='2020-02-24') AS openstk ON uniquerc.urcno=openstk.rcno LEFT JOIN(SELECT DISTINCT rcno,issued,received,used,scrap FROM `opiss` WHERE edate='2020-02-25') AS opissued ON uniquerc.urcno=opissued.rcno LEFT JOIN(SELECT DISTINCT rcno,qty AS nqty FROM `nextdayopening` WHERE edate='2020-02-25') AS nxopenstk ON uniquerc.urcno=nxopenstk.rcno LEFT JOIN(SELECT DISTINCT pnum AS m13pnum,useage AS ibom FROM `m13`) AS m13bom ON pnum=m13bom.m13pnum LEFT JOIN(SELECT DISTINCT pnum AS rmpnum,bom,obom FROM `rmcategory`) AS bom ON pnum=bom.rmpnum LEFT JOIN(SELECT invpnum,SUM(useage) AS tot FROM (SELECT DISTINCT pn_st.pnum,invpnum,useage FROM pn_st LEFT JOIN m13 ON m13.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS ipbompnst ON pnum=ipbompnst.invpnum LEFT JOIN(SELECT invpnum,SUM(obom) AS tot1 FROM (SELECT DISTINCT pn_st.pnum,invpnum,obom FROM pn_st LEFT JOIN rmcategory ON rmcategory.pnum=pn_st.pnum) AS T0 GROUP BY invpnum) AS opbompnst ON pnum=opbompnst.invpnum) AS DMR
LEFT JOIN(SELECT DISTINCT prcno,d12.pnum AS yrecpnum,SUM(partreceived) as yreceived,SUM(qtyrejected) as yrejected FROM `d12` WHERE d12.date>='2020-02-24' AND d12.date<='2020-02-24' AND prcno!='' GROUP BY d12.prcno) AS yrec ON DMR.urcno=yrec.prcno) AS DMRF LEFT JOIN(SELECT rcno,ret FROM `d14` WHERE date='2020-02-24') AS ret ON DMRF.urcno=ret.rcno ) AS DMRFI





